# command-guard.conf - Blocked command patterns for Claude Code
#
# Format: PATTERN | MESSAGE
# - PATTERN is a POSIX extended regex (ERE) matched against normalized commands
# - MESSAGE is shown to Claude when the command is blocked
# - Lines starting with # are comments
# - Empty lines are ignored
#
# The command guard normalizes commands before matching:
# - Strips leading/trailing whitespace
# - Unwraps subshells and command substitutions
# - Strips absolute path prefixes (/usr/bin/docker â†’ docker)
# - Strips env assignments and wrapper commands (sudo, env, command)
# - Normalizes package manager flags
#
# To customize: edit this file. It is preserved during --update.

# --- Docker: use make targets instead ---
^docker[[:space:]]+(compose|build|run) | Use `make` targets instead of direct Docker commands. Run `make help` for available targets.
^docker-compose | Use `make` targets instead of direct Docker commands. Run `make help` for available targets.

# --- Package managers: edit package.json instead ---
^pnpm[[:space:]]+add([[:space:]]|$) | Do not add dependencies via CLI. Edit package.json, then run `make install`.
^npm[[:space:]]+(install|i)[[:space:]]+. | Do not add dependencies via CLI. Edit package.json, then run `make install`.
^yarn[[:space:]]+add([[:space:]]|$) | Do not add dependencies via CLI. Edit package.json, then run `make install`.

# --- Bare install: use make install ---
^(pnpm|npm|yarn)[[:space:]]+(install|i|ci)([[:space:]]|$) | Do not run install commands on the host. Use `make install` which handles platform-specific binaries.

# --- Uncomment to block other patterns ---
# ^pip3?[[:space:]]+install([[:space:]]|$) | Do not install Python packages directly. Use your project's package management.
# ^cd[[:space:]]+(\.\/)?infra([/[:space:]]|$) | Do not cd into infra/. Use make targets which handle paths correctly.
